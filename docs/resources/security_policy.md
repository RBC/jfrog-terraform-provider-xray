---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "xray_security_policy Resource - terraform-provider-xray"
subcategory: "Policies"
---

# xray_security_policy (Resource)

Creates an Xray Policy using V2 of the underlying APIs.
Please note: It's only compatible with Bearer token auth method (Identity and Access => Access Tokens).

[Official documentation](https://www.jfrog.com/confluence/display/JFROG/Creating+Xray+Policies+and+Rules).

[API documentation](https://www.jfrog.com/confluence/display/JFROG/Xray+REST+API#XrayRESTAPI-CreatePolicy).


## Example Usage

```terraform
resource "xray_security_policy" "min_severity" {
  name        = "test-security-policy-severity"
  description = "Security policy description"
  type        = "security"
  project_key = "testproj"

  rule {
    name     = "rule-name-severity"
    priority = 1

    criteria {
      min_severity          = "High"
      fix_version_dependant = false
    }

    actions {
      webhooks                           = []
      mails                              = ["test@email.com"]
      block_release_bundle_distribution  = true
      block_release_bundle_promotion     = true
      fail_build                         = true
      notify_watch_recipients            = true
      notify_deployer                    = true
      create_ticket_enabled              = false // set to true only if Jira integration is enabled
      build_failure_grace_period_in_days = 5     // use only if fail_build is enabled

      block_download {
        unscanned = true
        active    = true
      }
    }
  }
}

resource "xray_security_policy" "cvss_score" {
  name        = "test-security-policy-cvss"
  description = "Security policy description"
  type        = "security"
  project_key = "testproj"

  rule {
    name     = "rule-name-cvss"
    priority = 1

    criteria {

      cvss_range {
        from = 1.5
        to   = 5.3
      }
    }

    actions {
      webhooks                           = []
      mails                              = ["test@email.com"]
      block_release_bundle_distribution  = true
      fail_build                         = true
      notify_watch_recipients            = true
      notify_deployer                    = true
      create_ticket_enabled              = false // set to true only if Jira integration is enabled
      build_failure_grace_period_in_days = 5     // use only if fail_build is enabled

      block_download {
        unscanned = true
        active    = true
      }
    }
  }
}

resource "xray_security_policy" "malicious_package" {
  name        = "test-security-policy-mal-pkg"
  description = "Security policy description"
  type        = "security"
  project_key = "testproj"

  rule {
    name     = "rule-name-mp"
    priority = 1

    criteria {
      malicious_package = true
    }

    actions {
      webhooks                           = []
      mails                              = ["test@email.com"]
      block_release_bundle_distribution  = true
      fail_build                         = true
      notify_watch_recipients            = true
      notify_deployer                    = true
      create_ticket_enabled              = false // set to true only if Jira integration is enabled
      build_failure_grace_period_in_days = 5     // use only if fail_build is enabled

      block_download {
        unscanned = true
        active    = true
      }
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name` (String) Name of the policy (must be unique)
- `type` (String) Type of the policy

### Optional

- `description` (String) More verbose description of the policy
- `project_key` (String) Project key for assigning this resource to. Must be 2 - 10 lowercase alphanumeric and hyphen characters.
- `rule` (Block Set) A list of user-defined rules allowing you to trigger violations for specific vulnerability or license breaches by setting a license or security criteria, with a corresponding set of automatic actions according to your needs. Rules are processed according to the ascending order in which they are placed in the Rules list on the Policy. If a rule is met, the subsequent rules in the list will not be applied. (see [below for nested schema](#nestedblock--rule))

### Read-Only

- `author` (String) User, who created the policy
- `created` (String) Creation timestamp
- `id` (String) The ID of this resource.
- `modified` (String) Modification timestamp

<a id="nestedblock--rule"></a>
### Nested Schema for `rule`

Required:

- `name` (String) Name of the rule
- `priority` (Number) Integer describing the rule priority. Must be at least 1

Optional:

- `actions` (Block Set) Specifies the actions to take once a security policy violation has been triggered. (see [below for nested schema](#nestedblock--rule--actions))
- `criteria` (Block Set) The set of security conditions to examine when an scanned artifact is scanned. (see [below for nested schema](#nestedblock--rule--criteria))

<a id="nestedblock--rule--actions"></a>
### Nested Schema for `rule.actions`

Optional:

- `block_download` (Block Set) Block download of artifacts that meet the Artifact Filter and Severity Filter specifications for this watch (see [below for nested schema](#nestedblock--rule--actions--block_download))
- `block_release_bundle_distribution` (Boolean) Blocks Release Bundle distribution to Edge nodes if a violation is found. Default value is `false`.
- `block_release_bundle_promotion` (Boolean) Blocks Release Bundle promotion if a violation is found. Default value is `false`.
- `build_failure_grace_period_in_days` (Number) Allow grace period for certain number of days. All violations will be ignored during this time. To be used only if `fail_build` is enabled. Default value is `0`
- `create_ticket_enabled` (Boolean) Create Jira Ticket for this Policy Violation. Requires configured Jira integration. Default value is `false`.
- `fail_build` (Boolean) Whether or not the related CI build should be marked as failed if a violation is triggered. This option is only available when the policy is applied to an `xray_watch` resource with a `type` of `builds`. Default value is `false`.
- `mails` (Set of String) A list of email addressed that will get emailed when a violation is triggered.
- `notify_deployer` (Boolean) Sends an email message to component deployer with details about the generated Violations. Default value is `false`.
- `notify_watch_recipients` (Boolean) Sends an email message to all configured recipients inside a specific watch with details about the generated Violations. Default value is `false`.
- `webhooks` (Set of String) A list of Xray-configured webhook URLs to be invoked if a violation is triggered.

<a id="nestedblock--rule--actions--block_download"></a>
### Nested Schema for `rule.actions.block_download`

Optional:

- `active` (Boolean) Whether or not to block download of artifacts that meet the artifact and severity `filters` for the associated `xray_watch` resource. Default value is `false`.
- `unscanned` (Boolean) Whether or not to block download of artifacts that meet the artifact `filters` for the associated `xray_watch` resource but have not been scanned yet. Can not be set to `true` if attribute `active` is `false`. Default value is `false`.



<a id="nestedblock--rule--criteria"></a>
### Nested Schema for `rule.criteria`

Optional:

- `applicable_cves_only` (Boolean) Mark to skip CVEs that are not applicable in the context of the artifact. The contextual analysis operation might be long and affect build time if the `fail_build` action is set.

~>Only supported by JFrog Advanced Security
- `cvss_range` (Block List) The CVSS score range to apply to the rule. This is used for a fine-grained control, rather than using the predefined severities. The score range is based on CVSS v3 scoring, and CVSS v2 score is CVSS v3 score is not available. (see [below for nested schema](#nestedblock--rule--criteria--cvss_range))
- `exposures` (Block List) Creates policy rules for specific exposures.

~>Only supported by JFrog Advanced Security (see [below for nested schema](#nestedblock--rule--criteria--exposures))
- `fix_version_dependant` (Boolean) Issues that do not have a fixed version are not generated until a fixed version is available. Must be `false` with `malicious_package` enabled.
- `malicious_package` (Boolean) Generating a violation on a malicious package.
- `min_severity` (String) The minimum security vulnerability severity that will be impacted by the policy. Valid values: `All Severities`, `Critical`, `High`, `Medium`, `Low`
- `package_name` (String) The package name to create a rule for
- `package_type` (String) The package type to create a rule for
- `package_versions` (Set of String) package versions to apply the rule on can be (,) for any version or an open range (1,4) or closed [1,4] or one version [1]
- `vulnerability_ids` (List of String) Creates policy rules for specific vulnerability IDs that you input. You can add multiple vulnerabilities IDs up to 100. CVEs and Xray IDs are supported. Example - CVE-2015-20107, XRAY-2344

<a id="nestedblock--rule--criteria--cvss_range"></a>
### Nested Schema for `rule.criteria.cvss_range`

Required:

- `from` (Number) The beginning of the range of CVS scores (from 1-10, float) to flag.
- `to` (Number) The end of the range of CVS scores (from 1-10, float) to flag.


<a id="nestedblock--rule--criteria--exposures"></a>
### Nested Schema for `rule.criteria.exposures`

Optional:

- `applications` (Boolean) Applications exposures.
- `iac` (Boolean) Iac exposures.
- `min_severity` (String) The minimum security vulnerability severity that will be impacted by the policy. Valid values: `All Severities`, `Critical`, `High`, `Medium`, `Low`
- `secrets` (Boolean) Secrets exposures.
- `services` (Boolean) Services exposures.

## Import

Import is supported using the following syntax:

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```sh
terraform import xray_security_policy.my-policy policy-name
```